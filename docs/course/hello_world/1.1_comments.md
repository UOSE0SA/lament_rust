# 1.1 注释 (comments)

> [官方文档](https://doc.rust-lang.org/reference/comments.html)

### 什么是注释?

注释就是对代码的解释和说明，其目的是让人们能够更加轻松地了解代码。注释是编写程序时，写程序的人给一个语句、程序段、函数等的解释或提示，能提高程序代码的可读性。

注释只是为了提高可读性，不会被计算机编译。



### Rust中的注释

#### 非文档注释

> *原文:[ Non-doc comments](https://doc.rust-lang.org/reference/comments.html#non-doc-comments)*
>
> *Comments follow the general C++ style of line () and block () comment forms. Nested block comments are supported.`//``/* ... */`*
>
> *Non-doc comments are interpreted as a form of whitespace.*



注释遵循 C++ 的通用风格，包括行注释（`//`）和块注释（`/* ... */`）形式。支持嵌套块注释。`// /* ... */`

非文档注释会被解释为一种空白符。



我们知道注释只为了可读性，不会被编译，在Rust中，行注释是这样写的：

``````rust
// 这是一个注释
fn main() {
  println!("Hello, world!");
}
``````

但是，除了举例子，我们一般不会写这样的~~（没用）~~行注释，可以参照下面的事项：

> [!CAUTION]
>
> 避免逐行注释，应编写聚焦于“为什么”的注释，而不是“是什么”



好的例子:
> [!NOTE]
> ###### 源文件
> 
> Zip File: <a href="../src/hello_world/1.1/row_comment/zip/row_comment.zip" download>**点击我下载**</a>
>
> Markdown Link: [Markdown](/src/hello_world/1.1/row_comment/md/row_comment.md)
```rust
fn main() {
    let n : i32 = 0;
    println!("The {}th Fibonacci number is {}", n, fibonacci_sequence(n))
}

fn fibonacci_sequence(index: i32) -> i32 {
    // 计算斐波那契数列第index项，n=0或1时直接返回index
    if index == 0 {
        index
    } else if index == 1 {
        index
    } else {
        fibonacci_sequence(index - 1) + fibonacci_sequence(index - 2)
    }
}
```


Rust本身没有特殊的TODO/FIXME语法，但开发者习惯用普通注释加这些关键词标记待办事项。比如：

``````rust
// TODO: 实现用户登录功能
// FIXME: 此处存在性能瓶颈，需优化
``````

这样的注释能帮团队快速定位问题，很多编辑器（如VS Code、RustRover）还会自动标与其他注释不一样的颜色的提示！

#### 块注释

我们来看看块注释（被大部分人们称为多行注释）：

> [!NOTE]
> ###### 源文件
>
> Zip File: <a href="../src/hello_world/1.1/row_comment/zip/row_comment.zip" download>**点击我下载**</a>
>
> Markdown Link: [Markdown](/src/hello_world/1.1/row_comment/md/row_comment.md)

```rust
/* 错误写法:
int main() {
  println!("Hello, world!");
}
这不是C++！！！
*/
fn main() {
  println!("Hello, world!");
}
```

但是，Rust社区更倾向于行注释，块注释仅用于临时屏蔽代码最后我们看看文档注释.

> *原文：*[ Doc comments](https://doc.rust-lang.org/reference/comments.html#doc-comments)
>
> Line doc comments beginning with exactly *three* slashes (), and block doc comments (), both outer doc comments, are interpreted as a special syntax for [`doc` attributes](https://doc.rust-lang.org/rustdoc/the-doc-attribute.html).`///``/** ... */`
>
> That is, they are equivalent to writing around the body of the comment, i.e., turns into and turns into . They must therefore appear before something that accepts an outer attribute.`#[doc="..."]``/// Foo``#[doc="Foo"]``/** Bar */``#[doc="Bar"]`
>
> Line comments beginning with and block comments are doc comments that apply to the parent of the comment, rather than the item that follows.`//!``/*! ... */`
>
> That is, they are equivalent to writing around the body of the comment. comments are usually used to document modules that occupy a source file.`#![doc="..."]``//!`
>
> The character (CR) is not allowed in doc comments.`U+000D`



### 文档注释

以恰好三个斜杠（`///`）开头的行文档注释，以及块文档注释（`/** ... */`）——两者均为外部文档注释.

被解释为文档属性的特殊语法。`///` `/** ... */`   也就是说，它们等同于在注释主体周围添加 `#[doc="..."]`，即 `/// Foo` 变为 `#[doc="Foo"]`，`/** Bar */` 变为 `#[doc="Bar"]`。因此，它们必须出现在接受外部属性的内容之前。   以 `//!` 开头的行注释和 `/*! ... */` 块注释是应用于注释父级而非后续项的文档注释。   也就是说，它们等同于在注释主体周围添加 `#![doc="..."]`。`//!` 注释通常用于为占据源文件的模块添加文档。   文档注释中不允许出现 U+000D 字符（回车符）。

> [!NOTE]
>
> 按照惯例，文档注释通常包含 Markdown 格式的内容，这也是 `rustdoc` 工具所期望的。不过，注释语法并不考虑内部的 Markdown 结构。例如，`/** `glob = "*/*.rs";` */` 会在遇到第一个 `*/` 时就终止注释，而剩余的代码会导致语法错误。与行文档注释相比，这对块文档注释的内容造成了一定限制。

> [!NOTE]
>
> 由 U+000D（回车符，CR）紧跟 U+000A（换行符，LF）组成的字符序列，此前会被转换为单个 U+000A（换行符，LF）。

例如这样的代码：

``````rust
/// 计算两个整数的和。
/// 
/// # 参数
/// - `a`：第一个加数。
/// - `b`：第二个加数。
/// 
/// # 返回值
/// 两个数的和。
/// 
/// # 示例
/// ```rust
/// let result = add(2, 3);
/// assert_eq!(result, 5);
/// ```
fn add(a: i32, b: i32) -> i32 {
    a + b
}
``````

我们可以使用`cargo doc --open`生成文档

生成的文档在`target/doc/项目名称/index.html`中



### 注意事项

##### 我们应该如何编写一个好的注释？

• 不要过度注释：代码逻辑清晰时（如let sum = a + b;），无需注释。

• 注释与代码同步更新：修改代码后及时更新注释，避免“误导性注释”。

• 文档注释的风格统一：推荐使用标准库的格式（参数用# 参数，示例用代码块）。



### 习题练习

1. 分析Rust开源项目（如`rand`或`serde`）的注释风格。
2. 查看rand库中rand::thread_rng函数的文档注释，模仿它的格式，给本节课的add函数补充更详细的注释。
3. 尝试用cargo doc生成自己代码的文档